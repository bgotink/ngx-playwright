var m={attribute:/\[\s*(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(\s(?<caseSensitive>[iIsS]))?\s*)?\]/gu,id:/#(?<name>[-\w\P{ASCII}]+)/gu,class:/\.(?<name>[-\w\P{ASCII}]+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>¶*)\))?/gu,"pseudo-class":/:(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>¶*)\))?/gu,universal:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?\*/gu,type:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)/gu},P=new Set(["combinator","comma"]),x=new Set(["not","is","where","has","matches","-moz-any","-webkit-any","nth-child","nth-last-child"]),k=/(?<index>[\dn+-]+)\s+of\s+(?<subtree>.+)/,T={"nth-child":k,"nth-last-child":k},v=e=>{switch(e){case"pseudo-element":case"pseudo-class":return new RegExp(m[e].source.replace("(?<argument>\xB6*)","(?<argument>.*)"),"gu");default:return m[e]}};function $(e,r){let t=0,n="";for(;r<e.length;r++){let o=e[r];switch(o){case"(":++t;break;case")":--t;break}if(n+=o,t===0)return n}return n}function R(e,r=m){if(!e)return[];let t=[e];for(let[o,i]of Object.entries(r))for(let s=0;s<t.length;s++){let c=t[s];if(typeof c!="string")continue;i.lastIndex=0;let u=i.exec(c);if(!u)continue;let h=u.index-1,f=[],y=u[0],E=c.slice(0,h+1);E&&f.push(E),f.push({...u.groups,type:o,content:y});let I=c.slice(h+y.length+1);I&&f.push(I),t.splice(s,1,...f)}let n=0;for(let o of t)switch(typeof o){case"string":throw new Error(`Unexpected sequence ${o} found at index ${n}`);case"object":n+=o.content.length,o.pos=[n-o.content.length,n],P.has(o.type)&&(o.content=o.content.trim()||" ");break}return t}var O=/(['"])([^\\\n]+?)\1/g,N=/\\./g;function _(e,r=m){if(e=e.trim(),e==="")return[];let t=[];e=e.replace(N,(i,s)=>(t.push({value:i,offset:s}),"\uE000".repeat(i.length))),e=e.replace(O,(i,s,c,u)=>(t.push({value:i,offset:u}),`${s}${"\uE001".repeat(c.length)}${s}`));{let i=0,s;for(;(s=e.indexOf("(",i))>-1;){let c=$(e,s);t.push({value:c,offset:s}),e=`${e.substring(0,s)}(${"\xB6".repeat(c.length-2)})${e.substring(s+c.length)}`,i=s+c.length}}let n=R(e,r),o=new Set;for(let i of t.reverse())for(let s of n){let{offset:c,value:u}=i;if(!(s.pos[0]<=c&&c+u.length<=s.pos[1]))continue;let{content:h}=s,f=c-s.pos[0];s.content=h.slice(0,f)+u+h.slice(f+u.length),s.content!==h&&o.add(s)}for(let i of o){let s=v(i.type);if(!s)throw new Error(`Unknown token type: ${i.type}`);s.lastIndex=0;let c=s.exec(i.content);if(!c)throw new Error(`Unable to parse content for ${i.type}: ${i.content}`);Object.assign(i,c.groups)}return n}function g(e,{list:r=!0}={}){if(r&&e.find(t=>t.type==="comma")){let t=[],n=[];for(let o=0;o<e.length;o++)if(e[o].type==="comma"){if(n.length===0)throw new Error("Incorrect comma at "+o);t.push(g(n,{list:!1})),n.length=0}else n.push(e[o]);if(n.length===0)throw new Error("Trailing comma");return t.push(g(n,{list:!1})),{type:"list",list:t}}for(let t=e.length-1;t>=0;t--){let n=e[t];if(n.type==="combinator"){let o=e.slice(0,t),i=e.slice(t+1);return{type:"complex",combinator:n.content,left:g(o),right:g(i)}}}switch(e.length){case 0:throw new Error("Could not build AST.");case 1:return e[0];default:return{type:"compound",list:[...e]}}}function*p(e,r){switch(e.type){case"list":for(let t of e.list)yield*p(t,e);break;case"complex":yield*p(e.left,e),yield*p(e.right,e);break;case"compound":yield*e.list.map(t=>[t,e]);break;default:yield[e,r]}}function d(e,{recursive:r=!0,list:t=!0}={}){let n=_(e);if(!n)return;let o=g(n,{list:t});if(!r)return o;for(let[i]of p(o)){if(i.type!=="pseudo-class"||!i.argument||!x.has(i.name))continue;let s=i.argument,c=T[i.name];if(c){let u=c.exec(s);if(!u)continue;Object.assign(i,u.groups),s=u.groups.subtree}s&&Object.assign(i,{subtree:d(s,{recursive:!0,list:!0})})}return o}function U(e){return e.tagName==="SLOT"&&e.assignedNodes().length?e.assignedElements():Array.from((e.shadowRoot??e).children)}function C(e){return"documentElement"in e?e.documentElement:e}function*S(e){yield e;for(let r of U(e))yield*S(r)}function b(e){return e.assignedSlot?e.assignedSlot:e.parentElement?e.parentElement:e.parentNode?.host?e.parentNode.host:null}function w(e){if(e.assignedSlot){let r=e.assignedSlot.assignedElements();return r[r.indexOf(e)-1]??null}return e.previousElementSibling}function a(e,r,t){switch(t.type){case"universal":return!0;case"attribute":return e.matches(t.content);case"class":return e.classList.contains(t.name);case"id":return e.id===t.name;case"type":return e.tagName.toLowerCase()===t.name.toLowerCase();case"list":for(let n of t.list)if(a(e,r,n))return!0;return!1;case"compound":for(let n of t.list)if(!a(e,r,n))return!1;return!0;case"pseudo-class":switch(t.name){case"root":return t.subtree&&l(t.content),e===r.ownerDocument.documentElement;case"scope":return t.subtree&&l(t.content),e===r;case"is":case"where":return t.subtree||l(t.content),a(e,r,t.subtree);case"has":return t.argument||l(t.content),j(`:scope ${t.argument}`,e)!=null;case"not":return t.subtree||l(t.content),!a(e,r,t.subtree);case"host":case"host-context":return l(t.content);default:return e.matches(t.content)}case"complex":switch(t.combinator){case">":{let n=b(e);return n!=null&&a(e,r,t.right)&&a(n,r,t.left)}case" ":{let n=b(e);if(n==null||!a(e,r,t.right))return!1;for(;n!=null;){if(a(n,r,t.left))return!0;n=b(n)}return!1}case"+":{let n=w(e);return n!=null&&a(e,r,t.right)&&a(n,r,t.left)}case"~":{let n=w(e);if(n==null||!a(e,r,t.right))return!1;for(;n;){if(a(n,r,t.left))return!0;n=w(n)}return!1}}return A();case"pseudo-element":l(t.content)}A()}function l(e){throw new Error(`Invalid selector: ${e}`)}function A(){throw new Error("This code should be unreachable")}function j(e,r=document){let t=d(e)||l(e);r=C(r);for(let n of S(r))if(a(n,r,t))return n;return null}function z(e,r=document){let t=d(e)||l(e);r=C(r);let n=[];for(let o of S(r))a(o,r,t)&&n.push(o);return n}export{j as querySelector,z as querySelectorAll};
